{"version":3,"file":"windowed-observable.cjs.development.js","sources":["../src/observable.ts"],"sourcesContent":["export const EVENTS = '__events__';\nexport const SHARED = '__shared__';\nexport const OBSERVERS = '__observers__';\n\nexport type EventsArray<T = any> = Array<T>;\nexport type Observer<T = any> = (data: T | Array<T> | undefined) => void;\nexport type ObserversArray<T = any> = Array<Observer<T>>;\n\ndeclare global {\n  interface Window {\n    __shared__: {\n      __events__: Record<string, EventsArray>;\n      __observers__: Record<string, ObserversArray>;\n    };\n  }\n}\n\nexport interface SubscriptionOptions {\n  every?: boolean;\n  latest?: boolean;\n}\n\nexport class Observable<T = any> {\n  _namespace!: string;\n\n  private static initialize() {\n    if (!window[SHARED]) {\n      window[SHARED] = {\n        [EVENTS]: {},\n        [OBSERVERS]: {},\n      };\n    }\n    if (!window[SHARED][EVENTS]) {\n      window[SHARED][EVENTS] = {};\n    }\n    if (!window[SHARED][OBSERVERS]) {\n      window[SHARED][OBSERVERS] = {};\n    }\n  }\n\n  constructor(namespace: string) {\n    Observable.initialize();\n\n    this.namespace = namespace;\n  }\n\n  private get events(): EventsArray<T> {\n    return window[SHARED][EVENTS][this._namespace];\n  }\n\n  private set events(newEvents: EventsArray<T>) {\n    window[SHARED][EVENTS][this._namespace] = newEvents;\n  }\n\n  private get observers(): ObserversArray<T> {\n    return window[SHARED][OBSERVERS][this._namespace];\n  }\n\n  private set observers(newObservers: ObserversArray<T>) {\n    window[SHARED][OBSERVERS][this._namespace] = newObservers;\n  }\n\n  set namespace(namespace: string) {\n    this._namespace = namespace;\n\n    if (!this.events) this.events = [];\n    if (!this.observers) this.observers = [];\n  }\n\n  publish(data: T): void {\n    this.observers.forEach((observer: Observer<T>) => observer(data));\n\n    this.events.push(data);\n  }\n\n  dispatch = this.publish;\n\n  subscribe(\n    observer: Observer<T>,\n    options: SubscriptionOptions = { latest: false, every: false }\n  ): void {\n    const { every, latest } = options;\n\n    const events = this.events;\n    const hasOptions = latest || every;\n    if (hasOptions && events.length > 0) {\n      if (latest) {\n        const lastEvent = events[events.length - 1];\n        observer(lastEvent);\n      }\n\n      if (every) {\n        observer(events);\n      }\n    }\n\n    this.observers = this.observers.concat(observer);\n  }\n\n  unsubscribe(observer: Observer<T>): void {\n    this.observers = this.observers.filter((obs) => obs !== observer);\n  }\n\n  clear(): void {\n    this.observers?.forEach((observer: Observer<T>) => observer(undefined));\n\n    this.events = [];\n    this.observers = [];\n  }\n}\n"],"names":["EVENTS","SHARED","OBSERVERS","Observable","namespace","publish","initialize","window","data","observers","forEach","observer","events","push","subscribe","options","latest","every","hasOptions","length","lastEvent","concat","unsubscribe","filter","obs","clear","undefined","_namespace","newEvents","newObservers"],"mappings":"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"}